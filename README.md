# DevOps Agent System (MCP‑A2A)

## Overview

This repository implements an **AI‑to‑AI (A2A) orchestration system** that can:
- List existing GitHub Actions workflows.
- Dynamically create new CI pipelines with unique names.
- Use a manager agent powered by GitHub Models (or Azure AI inference) to decide which tool to invoke based on a user objective.

The core components are:
- **ManagerAgent** – builds a prompt, calls the LLM, parses the JSON response and dispatches the task.
- **DevOpsAgent** – provides the actual GitHub API calls (`list_workflows`, `create_basic_pipeline`).
- **devops_server.py** – a FastMCP server exposing the DevOps tools as callable functions.
- **a2a_system.py** – the entry‑point script that runs the manager agent.

## Architecture Overview

**MCP (Multi‑Agent Coordination Platform)**
- A lightweight framework (`FastMCP`) that lets you expose functions as *tools* callable by an LLM.
- Registers each DevOps operation (`list_workflows`, `create_basic_pipeline`) with `@mcp.tool()`.
- Handles the JSON‑RPC‑style request/response loop so the LLM can invoke a tool by name and arguments.
- Keeps the system modular – new agents or tools can be added without touching the core orchestration logic.

**A2A (Agent‑to‑Agent) Protocol**
- Enables one LLM‑driven agent (**ManagerAgent**) to coordinate other specialized agents (**DevOpsAgent**).
- The manager builds a prompt describing the user goal, available agents, and rules, then sends it to a GitHub model.
- The model returns a JSON plan: `{ "agent_name": "...", "tool": "...", "args": {...} }`.
- `ManagerAgent` parses the plan and dispatches the request to the appropriate agent via MCP.
- The chosen tool runs, returns a result, and the manager reports it back to the user.

**Why this matters**
- *Separation of concerns*: the manager decides *what* to do, while the DevOps agent knows *how* to talk to GitHub.
- *Extensibility*: add a new agent (e.g., a `K8sAgent`) and simply register its tools with MCP; the manager can start using them by updating its prompt.
- *Dynamic orchestration*: the LLM can reason about the current state (e.g., “if no pipelines exist, create one”) and pick the correct tool without hard‑coded conditionals.


## Prerequisites

- Python 3.11+ (tested on Windows 10).
- [uv](https://github.com/astral-sh/uv) for dependency management.
- A **GitHub Personal Access Token** with `repo` scope (or at least `contents:write` and `actions:read`).
- An `.env` file at the project root containing:
  ```
  GITHUB_TOKEN=your_token_here
  OPENAI_API_KEY=your_openai_key_if_using_openai_models
  ```

## Setup

```bash
# Clone the repo
git clone https://github.com/yourusername/MCP-A2A-GA.git
cd MCP-A2A-GA/devops-agent-system

# Install dependencies using uv
uv sync

# Load environment variables (optional, uv will respect .env automatically)
uv run python -c "import dotenv; dotenv.load_dotenv()"
```

## Usage

```bash
# Run the A2A system – it will list existing pipelines and then create a new one.
uv run a2a_system.py
```

You can also call the individual tools via the FastMCP server:
```bash
uv run devops_server.py
```

## Project Structure

```
devops-agent-system/
├─ src/                     # Core source code
│   ├─ __init__.py
│   ├─ a2a_system.py       # Manager agent entry point
│   └─ devops_server.py    # FastMCP server exposing DevOps tools
├─ tests/                   # Test scripts
│   ├─ test_models.py
│   └─ test_user_model.py
├─ .github/
│   └─ workflows/           # Example CI workflow files (generated dynamically)
├─ .env                     # Environment variables (not committed)
├─ README.md                # This file
└─ pyproject.toml           # Project metadata (generated by uv)
```

### Adding New Agents or Tools

1. Create a new class in `src/` that follows the same pattern as `ManagerAgent`.
2. Register the tool with `@mcp.tool()` in `devops_server.py`.
3. Update the prompt in `ManagerAgent.run_mission` to expose the new capabilities.

## Contributing

Feel free to open issues or submit pull requests. Please ensure that any new tool respects the token permissions and that new workflows are created with unique filenames (the system already handles this).

## License

MIT License – see `LICENSE` file.
